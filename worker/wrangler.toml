name = "custard-calendar"
main = "src/index.js"
compatibility_date = "2024-09-23"

[vars]
ENVIRONMENT = "production"
# Access token for limiting access during testing.
# Remove or leave empty for open access.
# For better security, use: npx wrangler secret put ACCESS_TOKEN
ACCESS_TOKEN = ""
# CORS origin restriction. Set to your GitHub Pages URL in production.
# Leave empty for open access (default).
ALLOWED_ORIGIN = "https://custard.chriskaschner.com"
# Base URL for alert email links. Set to your Worker URL in production.
WORKER_BASE_URL = "https://custard.chriskaschner.com"
# Email sender address for alerts. Requires verified domain in Resend.
ALERT_FROM_EMAIL = "alerts@custard.chriskaschner.com"

# Secrets (set via: npx wrangler secret put <NAME>):
#   RESEND_API_KEY â€” API key from resend.com for sending alert emails

# KV namespace for caching flavor data + alert subscriptions (24h TTL)
[[kv_namespaces]]
binding = "FLAVOR_CACHE"
id = "1642a7da91e144cb9b233b940430250c"

# D1 database for durable historical snapshots
[[d1_databases]]
binding = "DB"
database_name = "custard-snapshots"
database_id = "fa11cb69-1e34-439c-8895-f1c0a938a543"
migrations_dir = "src/migrations"

# Cron triggers:
#   Daily alert check at noon UTC (6-7 AM Central)
#   Weekly digest at 2 PM UTC Sunday (8-9 AM Central)
[triggers]
crons = ["0 12 * * *", "0 14 * * 7"]
